# API получения данных о торговых позициях

### Описание

API предназначено для получения информации о торговых позициях. Данные включают в себя наименования, цены, остатки, характеристики, url-адреса страниц и картинок и могут быть использованы для передачи информации на сторонние ресурсы.

### Получить выборку данных

Метод:
```
GET /api/position/?start=:start&limit=:limit
```
где 
`:start` - смещение выборки,
`:limit` - максимальное количество в выборке.

>Если параметры `start` и/или `limit` не передаются, то будут установлены значения по умолчанию. Для `start` - 0, для `limit` - 100

В случае если данные отсутствуют, метод возвращает пустой массив.

##### Пример возвращаемой структуры

```json
[
    {
        "id": 43719,
        "code": "227910",
        "article": "7217(30217)",
        "price": 1021,
        "external_id": "70b33612-ec07-4bed-8d53-9e99d5607ac5",
        "grouptitle": "Подшипники",
        "storage": [
            {
                "idstorage": "779f4773-5e82-11d9-8f85-00c09f35bc76",
                "codestorage": "00009",
                "namestorage": "г.Челябинск, Троицкий тр., 66",
                "amount": "3"
            },
            ...
        ],
        "title": "Подшипник КамАЗ КПП-154 РОЛ.КОНИЧ.  7217(30217)",
        "uri": "katalog-zapchastej/podshipniki/podshipnik-kamaz-kpp-154-rol-konich-721730217-1286067544",
        "uri_override": 0,
        "groupid": 161,
        "content": null,
        "searchable": 1,
        "published": 1,
        "deleted": 0,
        "images": [
          {
            "parent": 28452,
            "name": "dbfae21c-e29b-40c9-961e-3d759e45098e-15",
            "file": "dbfae21c-e29b-40c9-961e-3d759e45098e-15.jpg",
            "url": "/assets/images/products/39682/small/dbfae21c-e29b-40c9-961e-3d759e45098e-15.jpg"
          },
          ...
        ]
    },
    ...
]
```

### Получить данные о позиции по коду

Метод:
```
GET /api/position/:code
```
где 
`:code` - код позиции.

В случае если торговая позиция не найдена, сервер возвращает ответ 404 и JSON с описанием ошибки.

##### Пример возвращаемой структуры

```json
{
    "id": 39682,
    "code": "258124",
    "article": "3307-1001066/53-12-1001020",
    "price": 270,
    "external_id": "dbfae21c-e29b-40c9-961e-3d759e45098e",
    "grouptitle": "ГАЗ легковой",
    "storage": [
        {
            "idstorage": "6e43d409-9771-4508-9cd3-5a934507644d",
            "codestorage": "00425",
            "namestorage": "г.Магнитогорск, ул.Заводская, 1/2",
            "amount": "5"
        }
    ],
    "title": "Подушка опоры двигателя ГАЗ-3307 передняя в сб (к-т)  3307-1001066",
    "uri": "katalog-zapchastej/gaz-legkovoj/podushka-opory-dvigatelya-gaz-3307-perednyaya-v-sb-k-t-3307-1001066-2275130335",
    "uri_override": 0,
    "groupid": 157,
    "content": null,
    "searchable": 1,
    "published": 1,
    "deleted": 0,
    "images": [
        {
            "parent": 0,
            "name": "dbfae21c-e29b-40c9-961e-3d759e45098e",
            "file": "dbfae21c-e29b-40c9-961e-3d759e45098e.jpg",
            "url": "/assets/images/products/39682/dbfae21c-e29b-40c9-961e-3d759e45098e.jpg"
        },
      ...
    ]
}
```

### Описание полей данных

Поле | Описание | Тип | Прим.
---------- | ---------- | ------- | -------
id | уникальный идентификатор позиции | integer
code | код позиции из 1С | string
article | артикл позиции | string
title | наименование позиции | string
price | цена с НДС | float
uri | адрес страницы карточки | string
uri_override | |
external_id | уникальный идентификатор позиции в 1С | uuid
grouptitle | наименование группы в 1C | string
groupid | уникальный идентификатор группы в 1С | uuid
storage | массив данных по остаткам на складах | array
idstorage | уникальный идентификатор склада в 1С | uuid
codestorage | код склада в 1С | string
namestorage | наименование склада | string
amount | остаток на складе | integer
content | |
searchable | |
published | |
deleted | |
images | массив данных с фотографиями | array
parent | идентификатор главной картинки в рамках таблицы БД. Если "0" - то фотография главная | integer
name | наименование картинки | string
file | наименование файла | string
url | url-адрес картинки | string

### Коды ответа сервера

Код ответа | Описание 
---------- | -----------------------
200 | запрос успешно обработан
404 | метод или позиция не существует
500 | внутренняя ошибка сервера

### Возврат описания ошибок

В случае если запрашиваемая позиция не найдена сервер отвечает кодом 404 и то в теле ответа передаётся описание ошибки в формате JSON.
Пример:
```
{
  "error": "position not found"
}
```